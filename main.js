(()=>{"use strict";var e=document.querySelector(".elements"),t=document.querySelector(".element-template").content,n=document.querySelector(".profile__name"),r=document.querySelector(".profile__about"),o=document.querySelector(".profile__avatar"),u=document.querySelector(".profile__edit-button"),c=document.querySelector(".profile__add-button"),i=document.querySelector(".profile__avatar-edit-button"),a=document.querySelector(".popup_type_avatar"),l=a.querySelector(".popup__form"),s=a.querySelector(".popup__item_el_avatar"),d=a.querySelector(".popup__submit-button"),p=document.querySelector(".popup_type_profile"),f=p.querySelector(".popup__form"),_=p.querySelector(".popup__item_el_name"),m=p.querySelector(".popup__item_el_about"),y=p.querySelector(".popup__submit-button"),h=document.querySelector(".popup_type_card"),v=h.querySelector(".popup__form"),b=h.querySelector(".popup__item_el_title"),S=h.querySelector(".popup__item_el_link"),q=h.querySelector(".popup__submit-button"),g=document.querySelector(".popup_type_image"),E=g.querySelector(".popup__image"),L=g.querySelector(".popup__figcaption"),k=Array.from(document.querySelectorAll(".popup")),A={form:"popup__form",submitButton:"popup__submit-button",submitButtonInactive:"popup__submit-button_inactive",input:"popup__item",inputError:"popup__item_type_error"},C={url:"https://nomoreparties.co/v1/plus-cohort-13/",headers:{authorization:"2dd7389d-c9b9-45d3-bbd5-6f3fcf495c19","Content-type":"application/json"}},x=function(e){return e.ok?e.json():Promise.reject(e.status)};function T(e){n.textContent=e.name,r.textContent=e.about,o.src=e.avatar,function(e){_.value=e.name,m.value=e.about}(e)}function w(e){"Escape"===e.key&&I(document.querySelector(".popup_opened"))}function j(e){e.classList.add("popup_opened"),document.addEventListener("keyup",w)}function I(e){e.classList.remove("popup_opened"),document.removeEventListener("keyup",w)}function O(e,t){t.textContent=e?"Сохранение...":"Сохраненить"}function P(e){E.src=e.target.closest(".element").querySelector(".element__image").src;var t=e.target.closest(".element").querySelector(".element__title").textContent;E.alt=t,L.textContent=t,j(g)}function B(e,n){var r=t.querySelector(".element").cloneNode(!0),o=r.querySelector(".element__title"),u=r.querySelector(".element__image"),c=r.querySelector(".element__like-button"),i=r.querySelector(".element__like-count"),a=r.querySelector(".element__delete-button");return function(e,t,n,r){var o=e.likes;0!==o.length&&(n.textContent=e.likes.length,o.find((function(e){return e._id===t}))&&r.classList.add("element__like-button_active"))}(e,n,i,c),function(e,t,n,r,o,u,c){r.addEventListener("click",(function(){return function(e,t,n){var r;e.classList.contains("element__like-button_active")?(r=t._id,fetch(C.url+"cards/likes/"+r,{method:"DELETE",headers:C.headers}).then((function(e){return x(e)}))).then((function(t){e.classList.remove("element__like-button_active"),n.textContent=t.likes.length})).catch((function(e){return console.log(e)})):function(e){return fetch(C.url+"cards/likes/"+e,{method:"PUT",headers:C.headers}).then((function(e){return x(e)}))}(t._id).then((function(t){e.classList.add("element__like-button_active"),n.textContent=t.likes.length})).catch((function(e){return console.log(e)}))}(r,t,o)})),c.addEventListener("click",P),function(e,t){return e.owner._id===t}(t,n)?u.addEventListener("click",(function(){return function(e,t){var n;(n=e._id,fetch(C.url+"/cards/"+n,{method:"DELETE",headers:C.headers}).then((function(e){return x(e)}))).catch((function(e){return console.log(e)})),t.remove()}(t,e)})):u.remove()}(r,e,n,c,i,a,u),o.textContent=e.name,u.src=e.link,u.alt=e.name,r}function N(t,n){e.prepend(B(t,n))}function D(e,t){var n=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(A.inputError),n.textContent=""}function J(e,t){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(A.submitButtonInactive),t.removeAttribute("disabled")):(t.classList.add(A.submitButtonInactive),t.setAttribute("disabled",!0))}function G(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}!function(e){Array.from(document.querySelectorAll(".".concat(e.form))).forEach((function(t){t.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var n=Array.from(e.querySelectorAll(".".concat(t.input))),r=e.querySelector(".".concat(t.submitButton));J(n,r),n.forEach((function(o){o.addEventListener("input",(function(){!function(e,t,n){t.validity.valid?D(e,t):function(e,t,n,r){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.add(r.inputError),o.textContent=n}(e,t,t.validationMessage,n)}(e,o,t),J(n,r)}))}))}(t,e)}))}(A),i.addEventListener("click",(function(){return j(a)})),u.addEventListener("click",(function(){return j(p)})),c.addEventListener("click",(function(){return j(h)})),l.addEventListener("submit",(function(e){var t;O(!0,d),(t={avatar:s.value},fetch(C.url+"users/me/avatar",{method:"PATCH",headers:C.headers,body:JSON.stringify(t)}).then((function(e){return x(e)}))).then((function(e){return T(e)})).then(I(a)).then(e.target.reset()).catch((function(e){return console.log(e)})).finally((function(){return O(!1,d)}))})),f.addEventListener("submit",(function(){var e;O(!0,y),(e={name:_.value,about:m.value},fetch(C.url+"users/me",{method:"PATCH",headers:C.headers,body:JSON.stringify(e)}).then((function(e){return x(e)}))).then((function(e){return T(e)})).then(I(p)).catch((function(e){return console.log(e)})).finally((function(){return O(!1,y)}))})),v.addEventListener("submit",(function(e){var t;O(!0,q),(t={name:b.value,link:S.value},fetch(C.url+"cards",{method:"POST",headers:C.headers,body:JSON.stringify(t)}).then((function(e){return x(e)}))).then((function(e){return N(e,e.owner._id)})).then(e.target.reset()).then(I(h)).catch((function(e){return console.log(e)})).finally((function(){return O(!1,q)})),q.setAttribute("disabled",!0),q.classList.add("popup__submit-button_inactive")})),k.forEach((function(e){e.addEventListener("mousedown",(function(t){(t.target.classList.contains("popup_opened")||t.target.classList.contains("popup__container"))&&I(e),t.target.classList.contains("popup__close-button")&&I(e)}))})),Promise.all([fetch(C.url+"cards",{method:"GET",headers:C.headers}).then((function(e){return x(e)})),fetch(C.url+"users/me",{method:"GET",headers:C.headers}).then((function(e){return x(e)}))]).then((function(e){var t,n,r=(n=2,function(e){if(Array.isArray(e))return e}(t=e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,u=[],c=!0,i=!1;try{for(n=n.call(e);!(c=(r=n.next()).done)&&(u.push(r.value),!t||u.length!==t);c=!0);}catch(e){i=!0,o=e}finally{try{c||null==n.return||n.return()}finally{if(i)throw o}}return u}}(t,n)||function(e,t){if(e){if("string"==typeof e)return G(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?G(e,t):void 0}}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),o=r[0],u=r[1];T(u);var c=u._id;o.forEach((function(e){return N(e,c)}))})).catch((function(e){return console.log(e)}))})();